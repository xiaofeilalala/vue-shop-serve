"use strict";(self["webpackChunkvue_shop"]=self["webpackChunkvue_shop"]||[]).push([[779],{779:function(t,e,a){a.r(e),a.d(e,{default:function(){return g}});var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"editgood-wrapper"},[a("el-card",[a("el-alert",{attrs:{title:"编辑商品信息",center:"",type:"success","show-icon":"",closable:!1}}),a("el-steps",{staticClass:"step-box",attrs:{simple:"",space:200,active:t.activeIndex-0,"align-center":!0,"finish-status":"success"}},[a("el-step",{attrs:{title:"基本信息"}}),a("el-step",{attrs:{title:"商品参数"}}),a("el-step",{attrs:{title:"商品属性"}}),a("el-step",{attrs:{title:"商品图片"}}),a("el-step",{attrs:{title:"商品内容"}}),a("el-step",{attrs:{title:"编辑商品"}})],1),a("el-form",{ref:"editGoodRef",staticClass:"form-box",attrs:{model:t.editGoodList,rules:t.editGoodRules,"label-position":"top"}},[a("el-tabs",{staticClass:"tab-box",attrs:{"tab-position":"left","before-leave":t.beforeTabsLeave},on:{"tab-click":t.tabClick},model:{value:t.activeIndex,callback:function(e){t.activeIndex=e},expression:"activeIndex"}},[a("el-tab-pane",{attrs:{label:"基本信息",name:"0"}},[a("el-form-item",{attrs:{label:"商品名称",prop:"goods_name"}},[a("el-input",{attrs:{placeholder:"请输入商品名称"},model:{value:t.editGoodList.goods_name,callback:function(e){t.$set(t.editGoodList,"goods_name",e)},expression:"editGoodList.goods_name"}})],1),a("el-form-item",{attrs:{label:"商品价格（元）",prop:"goods_price"}},[a("el-input-number",{attrs:{placeholder:"请输入商品价格","controls-position":"right"},model:{value:t.editGoodList.goods_price,callback:function(e){t.$set(t.editGoodList,"goods_price",e)},expression:"editGoodList.goods_price"}})],1),a("el-form-item",{attrs:{label:"商品数量",prop:"goods_number"}},[a("el-input-number",{attrs:{placeholder:"请输入商品数量","controls-position":"right"},model:{value:t.editGoodList.goods_number,callback:function(e){t.$set(t.editGoodList,"goods_number",e)},expression:"editGoodList.goods_number"}})],1),a("el-form-item",{attrs:{label:"商品重量（kg）",prop:"goods_weight"}},[a("el-input-number",{attrs:{placeholder:"请输入商品重量","controls-position":"right"},model:{value:t.editGoodList.goods_weight,callback:function(e){t.$set(t.editGoodList,"goods_weight",e)},expression:"editGoodList.goods_weight"}})],1),a("el-form-item",{attrs:{label:"商品分类",prop:"goods_introduce"}},[a("el-cascader",{ref:"cascaderRef",attrs:{options:t.cateList,props:t.editGoodProp},on:{change:t.handleChange},model:{value:t.editGoodList.goods_cat,callback:function(e){t.$set(t.editGoodList,"goods_cat",e)},expression:"editGoodList.goods_cat"}})],1)],1),a("el-tab-pane",{attrs:{label:"商品参数",name:"1"}},t._l(t.manyTabData,(function(e){return a("el-form-item",{key:e.attr_id,attrs:{label:e.attr_name}},[a("el-checkbox-group",{model:{value:e.attr_vals,callback:function(a){t.$set(e,"attr_vals",a)},expression:"item.attr_vals"}},t._l(e.attr_vals,(function(t,e){return a("el-checkbox",{key:e,attrs:{border:"",label:t}})})),1)],1)})),1),a("el-tab-pane",{attrs:{label:"商品属性",name:"2"}},t._l(t.onlyTabData,(function(e){return a("el-form-item",{key:e.attr_id,attrs:{label:e.attr_name}},[a("el-input",{model:{value:e.attr_vals,callback:function(a){t.$set(e,"attr_vals",a)},expression:"item.attr_vals"}})],1)})),1),a("el-tab-pane",{attrs:{label:"商品图片",name:"3"}},[a("el-upload",{staticClass:"upload-demo",attrs:{drag:"",action:t.path,multiple:"",headers:t.header,"list-type":"picture","on-success":t.handleSuccess,"on-remove":t.handleRemove,"on-preview":t.handlePreview}},[a("i",{staticClass:"el-icon-upload"}),a("div",{staticClass:"el-upload__text"},[t._v("将文件拖到此处，或"),a("em",[t._v("点击上传")])])])],1),a("el-tab-pane",{attrs:{label:"商品内容",name:"4"}},[a("div",{staticStyle:{border:"1px solid #ccc"}},[a("Toolbar",{staticStyle:{"border-bottom":"1px solid #ccc"},attrs:{editor:t.editor,defaultConfig:t.toolbarConfig,mode:t.mode}}),a("Editor",{staticStyle:{height:"400px","overflow-y":"hidden"},attrs:{defaultConfig:t.editorConfig,mode:t.mode},on:{onCreated:t.onCreated},model:{value:t.editGoodList.goods_introduce,callback:function(e){t.$set(t.editGoodList,"goods_introduce",e)},expression:"editGoodList.goods_introduce"}})],1)]),a("el-tab-pane",{attrs:{label:"编辑商品",name:"5"}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:t.editGood}},[t._v("编辑商品")])],1)],1)],1)],1)],1)},s=[],r=a(7906),i=a(6198),n=(a(1539),a(4747),a(4916),a(3123),a(4553),a(561),a(514),a(9600),a(3637)),d=a(69),l=a.n(d),c={data:function(){return{activeIndex:0,editGoodList:{},editGoodRules:{goods_name:[{required:!0,message:"请输入商品名称",trigger:"blur"}],goods_price:[{required:!0,message:"请输入商品价格",trigger:"blur"}],goods_number:[{required:!0,message:"请输入商品数量",trigger:"blur"}],goods_weight:[{required:!0,message:"请输入商品重量",trigger:"blur"}],goods_cate:[{required:!0,message:"请选择商品分类",trigger:"blur"}]},cateList:[],manyTabData:[],onlyTabData:[],editGoodProp:{expandTrigger:"hover",checkStrictly:!0,value:"cat_id",label:"cat_name",children:"children"},path:"http://127.0.0.1:8888/api/private/v1/upload",header:{Authorization:window.sessionStorage.getItem("token")},imgDialogVisible:!1,imgPath:"",editor:null,toolbarConfig:{},editorConfig:{placeholder:"请输入内容...",MENU_CONF:{uploadImage:{base64LimitSize:1024e4}}},mode:"simple"}},created:function(){this.getEditGoodList(),this.getCateList()},methods:{getCateList:function(){var t=this;return(0,i.Z)((0,r.Z)().mark((function e(){var a,o;return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$axios.get("categories");case 2:if(a=e.sent,o=a.data,200===o.meta.status){e.next=6;break}return e.abrupt("return",t.$message.error(o.meta.msg));case 6:t.cateList=o.data;case 7:case"end":return e.stop()}}),e)})))()},getEditGoodList:function(){var t=this;return(0,i.Z)((0,r.Z)().mark((function e(){var a,o;return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$axios.get("goods/".concat(t.$route.params.id));case 2:if(a=e.sent,o=a.data,200===o.meta.status){e.next=6;break}return e.abrupt("return",t.$message.error(o.meta.msg));case 6:t.editGoodList=o.data,t.editGoodList.goods_cat=[t.editGoodList.cat_one_id,t.editGoodList.cat_two_id,t.editGoodList.cat_three_id];case 8:case"end":return e.stop()}}),e)})))()},handleChange:function(){3!==this.editGoodList.goods_cat.length&&(this.editGoodList.goods_cat=[],this.$message.warning("请选择三级分类")),this.$refs.cascaderRef.toggleDropDownVisible()},beforeTabsLeave:function(t,e){if("0"===e&&3!==this.editGoodList.goods_cat.length)return this.$message.error("请选择商品分类"),!1},tabClick:function(){var t=this;return(0,i.Z)((0,r.Z)().mark((function e(){var a,o,s,i;return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("1"!==t.activeIndex){e.next=11;break}return e.next=3,t.$axios.get("categories/".concat(t.editGoodList.cat_three_id,"/attributes"),{params:{sel:"many"}});case 3:if(a=e.sent,o=a.data,200===o.meta.status){e.next=7;break}return e.abrupt("return",t.$message.error(o.meta.msg));case 7:o.data.forEach((function(t){t.attr_vals=0===t.attr_vals.length?[]:t.attr_vals.split(",")})),t.manyTabData=o.data,e.next=19;break;case 11:if("2"!==t.activeIndex){e.next=19;break}return e.next=14,t.$axios.get("categories/".concat(t.editGoodList.cat_three_id,"/attributes"),{params:{sel:"only"}});case 14:if(s=e.sent,i=s.data,200===i.meta.status){e.next=18;break}return e.abrupt("return",t.$message.error(i.meta.msg));case 18:t.onlyTabData=i.data;case 19:case"end":return e.stop()}}),e)})))()},handleSuccess:function(t){var e={pic:t.data.tmp_path};this.editGoodList.pics.push(e)},handleRemove:function(t){var e=t.response.data.tem_path,a=this.editGoodList.pics.findIndex((function(t){return t.pics===e}));this.editGoodList.pics.splice(a,1)},handlePreview:function(t){this.imgPath=t.response.data.url,this.imgDialogVisible=!0},onCreated:function(t){this.editor=Object.seal(t)},editGood:function(){var t=this;this.$refs.editGoodRef.validate(function(){var e=(0,i.Z)((0,r.Z)().mark((function e(a){var o,s,i;return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return",t.$message.error("请填写必要信息"));case 2:return o=l().cloneDeep(t.editGoodList),o.goods_cat=o.goods_cat.join(","),t.manyTabData.forEach((function(e){var a={attr_id:e.attr_id,attr_value:e.attr_vals.join(",")};t.editGoodList.attrs.push(a)})),t.onlyTabData.forEach((function(e){var a={attr_id:e.attr_id,attr_value:e.attr_vals};t.editGoodList.attrs.push(a)})),o.attrs=t.editGoodList.attrs,e.next=9,t.$axios.put("goods/".concat(t.$route.params.id),o);case 9:if(s=e.sent,i=s.data,200===i.meta.status){e.next=13;break}return e.abrupt("return",t.$message.error("编辑商品失败"));case 13:t.$message.success("编辑商品成功"),t.$router.push("/goods");case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},beforeDestroy:function(){var t=this.editor;null!=t&&t.destroy()},components:{Editor:n.M,Toolbar:n.o}},u=c,p=a(1001),m=(0,p.Z)(u,o,s,!1,null,null,null),g=m.exports}}]);
//# sourceMappingURL=779.5c95da0f.js.map